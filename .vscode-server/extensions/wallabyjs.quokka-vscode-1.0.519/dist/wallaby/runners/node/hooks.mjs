import{readdirSync}from"node:fs";import{join}from"node:path";import{pathToFileURL}from"url";function convertToPosix(o){return"win32"===process.platform?o.replace(/\\/g,"/"):o}export function findMatchingFiles(o,e,t,r){const n=[];for(const t of readdirSync(o))t.match(e)&&n.push(convertToPosix(join(o,t)));if(t&&0===n.length)throw new Error(`File '${e}' is not found in '${o}'`);if(r&&n.length>1)throw new Error(`More than one file '${e}' were found in '${o}'`);return n}export function patchFile(o,e){const t=pathToFileURL(o);global.$_$_esm_patches=global.$_$_esm_patches||{},global.$_$_esm_patches[t]?global.$_$_esm_patches[t].push(e):global.$_$_esm_patches[t]=[e]}export async function load(o,e,t){const r=await t(o,e,t);return global.$_$_esm_patches&&global.$_$_esm_patches[o]&&r.source&&(r.source=global.$_$_esm_patches[o].reduce(((o,e)=>e(o)),r.source.toString())),r}